# Applications

We expect users to interact with Kumoru primarily by creating applications and deploying them.

When an application is created, it is **not** deployed by default. You'll need to create an initial [deployment](#deployments) to have a running application.

## Create an Application

```shell
kumoru applications create [OPTIONS] LOCATION_UUID IMG_URL APP_NAME

```

### CLI
Concept | CLI Option | Description
------- | ---------- | -----------
certificate | -\\\-certificate | The path to a PEM encoded SSL certificate. Setting this on an application will enable SSL on all Ports
certificate chain| -\\\-certificate_chain | The path to a PEM encoded certificate chain. (optional)
environment file | -\\\-env_file | File containing environment variables
private key | -\\\-private_key | The path to a PEM encoded private key tied to the certificate. Required if used --certificate
SSL port | -ssl_port | Port tied to SSL certificate. See `-p` for details.
environment | -e | String containing a KEY=value environment variable that will be passed to the containers. You may specify multiple of these
rule | -r  | String containing tag=weight (i.e. latest=100). You may specify multiple of these and doing so will cause multiple deployments (1 for each tag)
port | -p | String standard docker port mapping (i.e. 80:8080 where 80 is the frontend port and 8080 is the port accessible in the container). You may specify multiple of these
labels | -l| String to be used as an identifier. You may specify multiple of these
metadata | -m | JSON string of arbitrary metadata

Concept | CLI Arguement | Description
------- | ------------- | -----------
location uuid | 1st | The UUID of the location the application is to be deployed in.
image url| 2nd | The url of the docker image. See below for acceptable urls.
application name | 3rd | The name of the application.

The following types of image urls are acceptable and may be transformed:

Input | Transformation
----- | --------------
image | registry.hub.docker.com/library/image
username/image | registry.hub.docker.com/username/image
myregistry.com/username/image | myregistry.com/username/image
user:password@myregistry.com/username/image | Private image

* If you are familiar with Docker you may notice there is no image tag listed in the `IMG_URL`. These are provided via the `rules` flag.

<aside class="warning">Kumoru uses the Docker registry v1 API to retrieve a list of tags for an image. We then use this tag to create a deployment and this tag will be pulled down any time an application container starts. Unfortunately this means that if you have an tag that gets updated after creation, our service will automatically pull it down when a container starts. This means you could have mutliple versions of an tag running at the same time. The solution is to either a) never change a tag once it's created or b) always create a deployment immediately after updating your tag.

## Get an Application

```shell
kumoru applications show APPLICATION_UUID
…
```

Returns all details of a given application.

## Get all Applications

```shell
kumoru applications list
…
```

Displays a list of all applications with minimal details.

## Update an Application

```shell
kumoru applications patch [OPTIONS] APPLICATION_UUID
…
```

Update a particular application parameter. 

* If you are changing the environment variables, you must pass all environment variables including any that were not changed.

See [Create an application](#create-an-application) for available options.

You must [create a deployment](#create-a-deployment) for the changes to take effect after performing an update.

## Delete an Application

```shell
kumoru applications delete APPLICATION_UUID
```

Deleting an application will remove all running containers and any loadbalancers associated with the application.

## Application Security

* External ingress traffic is only allowed to applications via their load balancer and only on the port specified. If no port is specified, external ingress traffic is not allowed.
* Access to the instances running the application containers is isolated to the Kumoru support team.

## Statuses

Status | Description
------ | -----------
draft | The application has been created but not yet deployed.
deploying | A deployment action has been started.
checking | Kumoru is determining if the application is running and/or externally available.
running  | The application has been deployed and is available externally.
archiving | The archival process us underway.
archived | All archive actions are complete and the deployments are no longer available.
errored | An error has ocurred.

## Logging

To see any logs generated by your application you must configure it to send them to a remote service. This can be done by using a logging library in your code or if your container image has an opterating system configuring a logging service (i.e.syslog) to forward logs to a remote service.
